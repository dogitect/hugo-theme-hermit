{{/*
  Figure shortcode with Hugo image processing
  Usage:
    {{< figure src="image.jpg" alt="Description" caption="Caption text" >}}
*/}}

{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "" -}}
{{- $caption := .Get "caption" | default "" -}}
{{- $class := .Get "class" | default "" -}}

<figure{{ with $class }} class="{{ . }}"{{ end }}>
  {{- with .Page.Resources.GetMatch $src -}}
    {{- $image := .Resize "800x" -}}
    <img src="{{ $image.Permalink }}" alt="{{ $alt }}" loading="lazy">
  {{- else -}}
    <img src="{{ $src | absURL }}" alt="{{ $alt }}" loading="lazy">
  {{- end -}}
  {{- with $caption -}}
    <figcaption>{{ . | markdownify }}</figcaption>
  {{- end -}}
</figure>
